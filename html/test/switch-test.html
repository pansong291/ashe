<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <title>Switcher</title>
  <style>
      body {
          margin: 0;
          height: 100vh;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          gap: 32px;
      }
  </style>
</head>
<body>
<h2>滑块可拖动的 Switch 开关</h2>
</body>
<script>
  [createSwitcher1(), createSwitcher2(), createSwitcher3()].forEach((sw) => {
    document.head.insertAdjacentHTML('beforeend', sw.style)
    document.body.append(sw.switcher)
  })

  function createSwitcher1() {
    const componentId = randomId()
    const clazz = {
      element: {
        switcher: "switcher-" + componentId,
        track: "track-" + componentId,
        slider: "slider-" + componentId
      },
      state: {
        enabled: "enabled",
        autoMove: "auto-move",
        transitional: "transitional"
      }
    }
    const props = {
      trackLength: 64,
      sliderRadius: 10,
      gap: 2
    }
    const style = `
    <style>
      .${clazz.element.switcher}, .${clazz.element.switcher} * {
          box-sizing: border-box;
          user-select: none;
      }
      .${clazz.element.switcher} {
          display: inline-block;
          cursor: pointer;
      }
      .${clazz.element.track} {
          position: relative;
          width: ${props.trackLength + (props.sliderRadius + props.gap) * 2}px;
          height: ${(props.sliderRadius + props.gap) * 2}px;
          border-radius: ${props.sliderRadius + props.gap}px;
          padding: ${props.gap}px;
          background-color: #bbb;
          transition: .3s background-color;
      }

      .${clazz.element.slider} {
          position: absolute;
          top: ${props.gap}px;
          left: ${props.gap}px;
          width: ${props.sliderRadius * 2}px;
          height: ${props.sliderRadius * 2}px;
          background-color: white;
          box-shadow: 0 0 4px 0 #00000040;
          border-radius: 50%;
      }

      .${clazz.element.switcher}:hover .${clazz.element.track} {
          background-color: #d0d0d0;
      }

      .${clazz.element.switcher}.${clazz.state.enabled} .${clazz.element.track} {
          background-color: #3d7fff;
      }

      .${clazz.element.switcher}.${clazz.state.enabled}:hover .${clazz.element.track} {
          background-color: #669eff;
      }

      .${clazz.element.switcher}.${clazz.state.autoMove} .${clazz.element.slider} {
          transition: .3s left;
      }
    </style>`
    const switcher = document.createElement("div")
    const track = document.createElement("div")
    const slider = document.createElement("div")
    switcher.classList.add(clazz.element.switcher, clazz.state.autoMove)
    track.classList.add(clazz.element.track)
    slider.classList.add(clazz.element.slider)
    track.append(slider)
    switcher.append(track)
    const data = {
      down: { x: 0, left: 0 },
      move: false,
      limit: { min: 0, max: 0 }
    }

    const sliderMouseMove = (e) => {
      data.move = true
      let v = e.pageX - data.down.x + data.down.left
      if (data.limit.min > v) v = data.limit.min
      if (v > data.limit.max) v = data.limit.max
      requestAnimationFrame(() => slider.style.left = `${v}px`)
    }

    const sliderMouseUp = () => {
      switcher.classList.add(clazz.state.autoMove)
      const selfStyle = window.getComputedStyle(slider)
      const isLeft = getNumber(selfStyle.left) * 2 < (data.limit.min + data.limit.max)
      switcher.classList[isLeft ? "remove" : "add"](clazz.state.enabled)
      const v = isLeft ? data.limit.min : data.limit.max
      requestAnimationFrame(() => slider.style.left = `${v}px`)
      document.removeEventListener("mousemove", sliderMouseMove)
      document.removeEventListener("mouseup", sliderMouseUp)
    }

    slider.addEventListener("mousedown", (e) => {
      switcher.classList.remove(clazz.state.autoMove)
      data.move = false
      data.down.x = e.pageX
      document.addEventListener("mousemove", sliderMouseMove)
      document.addEventListener("mouseup", sliderMouseUp)
    })

    switcher.addEventListener("mousedown", () => {
      const trackStyle = window.getComputedStyle(track)
      data.limit.min = getNumber(trackStyle.paddingLeft)
      data.limit.max = switcher.clientWidth - getNumber(trackStyle.paddingRight) - slider.offsetWidth
      const sliderStyle = window.getComputedStyle(slider)
      data.down.left = getNumber(sliderStyle.left)
    })

    slider.addEventListener("click", (e) => {
      if (data.move) e.stopPropagation()
    })

    switcher.addEventListener("click", () => {
      const isLeft = data.down.left * 2 < (data.limit.min + data.limit.max)
      const v = isLeft ? data.limit.max : data.limit.min
      switcher.classList[isLeft ? "add" : "remove"](clazz.state.enabled)
      requestAnimationFrame(() => slider.style.left = `${v}px`)
    }, false)

    return {
      style,
      switcher
    }
  }

  function createSwitcher2() {
    const componentId = randomId()
    const clazz = {
      element: {
        switcher: "switcher-" + componentId,
        track: "track-" + componentId,
        progress: "progress-" + componentId,
        slider: "slider-" + componentId
      },
      state: {
        enabled: "enabled",
        autoMove: "auto-move"
      }
    }
    const props = {
      trackLength: 64,
      sliderRadius: 10,
      gap: 3
    }
    const style = `
    <style>
      .${clazz.element.switcher}, .${clazz.element.switcher} * {
          user-select: none;
          box-sizing: border-box;
      }
      .${clazz.element.switcher} {
          display: inline-block;
          cursor: pointer;
      }
      .${clazz.element.track} {
          position: relative;
          width: ${props.trackLength + props.gap * 2}px;
          height: ${props.gap * 2}px;
          border-radius: ${props.gap}px;
          background-color: #bbb;
          transition: .3s background-color;
      }

      .${clazz.element.progress} {
          position: absolute;
          top: 0;
          left: 0;
          width: 0;
          height: inherit;
          border-radius: inherit;
          background-color: #3d7fff;
          transition-duration: .3s;
          transition-property: background-color;
      }

      .${clazz.element.slider} {
          position: absolute;
          top: ${props.gap - props.sliderRadius}px;
          left: ${props.gap - props.sliderRadius}px;
          width: ${props.sliderRadius * 2}px;
          height: ${props.sliderRadius * 2}px;
          background-color: white;
          box-shadow: 0 1px 3px #86909c;
          border-radius: 50%;
      }

      .${clazz.element.switcher}:hover .${clazz.element.track} {
          background-color: #d0d0d0;
      }

      .${clazz.element.switcher}:hover .${clazz.element.progress} {
          background-color: #669eff;
      }

      .${clazz.element.switcher}.${clazz.state.autoMove} .${clazz.element.progress} {
          transition-property: background-color,width;
      }

      .${clazz.element.switcher}.${clazz.state.autoMove} .${clazz.element.slider} {
          transition: .3s left;
      }
    </style>`
    const switcher = document.createElement("div")
    const track = document.createElement("div")
    const progress = document.createElement("div")
    const slider = document.createElement("div")
    switcher.classList.add(clazz.element.switcher, clazz.state.autoMove)
    track.classList.add(clazz.element.track)
    progress.classList.add(clazz.element.progress)
    slider.classList.add(clazz.element.slider)
    track.append(progress, slider)
    switcher.append(track)
    const data = {
      down: { x: 0, left: 0 },
      move: false,
      limit: { min: 0, max: 0 },
      base: 0
    }

    const sliderMouseMove = (e) => {
      data.move = true
      let v = e.pageX - data.down.x + data.down.left
      if (v < data.limit.min) v = data.limit.min
      if (v > data.limit.max) v = data.limit.max
      const w = v + data.base
      requestAnimationFrame(() => {
        slider.style.left = `${v}px`
        progress.style.width = `${w}px`
      })
    }

    const sliderMouseUp = () => {
      switcher.classList.add(clazz.state.autoMove)
      const selfStyle = window.getComputedStyle(slider)
      const isLeft = getNumber(selfStyle.left) * 2 < (data.limit.min + data.limit.max)
      switcher.classList[isLeft ? "remove" : "add"](clazz.state.enabled)
      const v = isLeft ? data.limit.min : data.limit.max
      const w = v + data.base
      requestAnimationFrame(() => {
        slider.style.left = `${v}px`
        progress.style.width = `${w}px`
      })
      document.removeEventListener("mousemove", sliderMouseMove)
      document.removeEventListener("mouseup", sliderMouseUp)
    }

    slider.addEventListener("mousedown", (e) => {
      switcher.classList.remove(clazz.state.autoMove)
      data.move = false
      data.down.x = e.pageX
      document.addEventListener("mousemove", sliderMouseMove)
      document.addEventListener("mouseup", sliderMouseUp)
    })

    switcher.addEventListener("mousedown", () => {
      data.limit.min = (track.offsetHeight - slider.offsetWidth) / 2
      data.limit.max = track.offsetWidth - (track.offsetHeight + slider.offsetWidth) / 2
      data.down.left = getNumber(window.getComputedStyle(slider).left)
      data.base = slider.offsetWidth / 2
    })

    slider.addEventListener("click", (e) => {
      if (data.move) e.stopPropagation()
    })

    switcher.addEventListener("click", () => {
      const isLeft = data.down.left * 2 < (data.limit.min + data.limit.max)
      switcher.classList[isLeft ? "add" : "remove"](clazz.state.enabled)
      const v = isLeft ? data.limit.max : data.limit.min
      const w = v + data.base
      requestAnimationFrame(() => {
        slider.style.left = `${v}px`
        progress.style.width = `${w}px`
      })
    }, false)

    return {
      style,
      switcher
    }
  }

  function createSwitcher3() {
    const componentId = randomId()
    const clazz = {
      element: {
        switcher: "switcher-" + componentId,
        track: "track-" + componentId,
        progress: "progress-" + componentId,
        slider: "slider-" + componentId
      },
      state: {
        enabled: "enabled",
        autoMove: "auto-move"
      }
    }
    const props = {
      trackLength: 64,
      sliderRadius: 10,
      gap: 2
    }
    const style = `
    <style>
      .${clazz.element.switcher}, .${clazz.element.switcher} * {
          user-select: none;
          box-sizing: border-box;
      }
      .${clazz.element.switcher} {
          display: inline-block;
          cursor: pointer;
      }
      .${clazz.element.track} {
          position: relative;
          width: ${props.trackLength + (props.sliderRadius + props.gap) * 2}px;
          height: ${(props.sliderRadius + props.gap) * 2}px;
          border-radius: ${props.sliderRadius + props.gap}px;
          padding: ${props.gap}px;
          background-color: #bbb;
          transition: .3s background-color;
      }

      .${clazz.element.progress} {
          position: absolute;
          top: 0;
          left: 0;
          width: ${(props.sliderRadius + props.gap) * 2}px;
          height: inherit;
          border-radius: inherit;
          background-color: #3d7fff;
          transition-duration: .3s;
          transition-property: background-color;
      }

      .${clazz.element.slider} {
          position: absolute;
          top: ${props.gap}px;
          left: ${props.gap}px;
          width: ${props.sliderRadius * 2}px;
          height: ${props.sliderRadius * 2}px;
          background-color: white;
          box-shadow: 0 0 4px 0 #00000040;
          border-radius: 50%;
      }

      .${clazz.element.switcher}:hover .${clazz.element.track} {
          background-color: #d0d0d0;
      }

      .${clazz.element.switcher}:hover .${clazz.element.progress} {
          background-color: #669eff;
      }

      .${clazz.element.switcher}.${clazz.state.autoMove} .${clazz.element.progress} {
          transition-property: background-color,width;
      }

      .${clazz.element.switcher}.${clazz.state.autoMove} .${clazz.element.slider} {
          transition: .3s left;
      }
    </style>`
    const switcher = document.createElement("div")
    const track = document.createElement("div")
    const progress = document.createElement("div")
    const slider = document.createElement("div")
    switcher.classList.add(clazz.element.switcher, clazz.state.autoMove)
    track.classList.add(clazz.element.track)
    progress.classList.add(clazz.element.progress)
    slider.classList.add(clazz.element.slider)
    track.append(progress, slider)
    switcher.append(track)
    const data = {
      down: { x: 0, left: 0 },
      move: false,
      limit: { min: 0, max: 0 },
      base: 0
    }

    const sliderMouseMove = (e) => {
      data.move = true
      let v = e.pageX - data.down.x + data.down.left
      if (v < data.limit.min) v = data.limit.min
      if (v > data.limit.max) v = data.limit.max
      const w = v + data.base
      requestAnimationFrame(() => {
        slider.style.left = `${v}px`
        progress.style.width = `${w}px`
      })
    }

    const sliderMouseUp = () => {
      switcher.classList.add(clazz.state.autoMove)
      const selfStyle = window.getComputedStyle(slider)
      const isLeft = getNumber(selfStyle.left) * 2 < (data.limit.min + data.limit.max)
      switcher.classList[isLeft ? "remove" : "add"](clazz.state.enabled)
      const v = isLeft ? data.limit.min : data.limit.max
      const w = v + data.base
      requestAnimationFrame(() => {
        slider.style.left = `${v}px`
        progress.style.width = `${w}px`
      })
      document.removeEventListener("mousemove", sliderMouseMove)
      document.removeEventListener("mouseup", sliderMouseUp)
    }

    slider.addEventListener("mousedown", (e) => {
      switcher.classList.remove(clazz.state.autoMove)
      data.move = false
      data.down.x = e.pageX
      document.addEventListener("mousemove", sliderMouseMove)
      document.addEventListener("mouseup", sliderMouseUp)
    })

    switcher.addEventListener("mousedown", () => {
      const trackStyle = window.getComputedStyle(track)
      data.limit.min = getNumber(trackStyle.paddingLeft)
      data.limit.max = switcher.clientWidth - getNumber(trackStyle.paddingRight) - slider.offsetWidth
      const sliderStyle = window.getComputedStyle(slider)
      data.down.left = getNumber(sliderStyle.left)
      data.base = track.offsetHeight - data.limit.min
    })

    slider.addEventListener("click", (e) => {
      if (data.move) e.stopPropagation()
    })

    switcher.addEventListener("click", () => {
      const isLeft = data.down.left * 2 < (data.limit.min + data.limit.max)
      switcher.classList[isLeft ? "add" : "remove"](clazz.state.enabled)
      const v = isLeft ? data.limit.max : data.limit.min
      const w = v + data.base
      requestAnimationFrame(() => {
        slider.style.left = `${v}px`
        progress.style.width = `${w}px`
      })
    }, false)

    return {
      style,
      switcher
    }
  }

  function getNumber(str) {
    let mArr = String(str).match(/[-+]?(\d+(\.\d*)?|\.\d+)/)
    if (mArr && mArr.length) {
      return parseFloat(mArr[0])
    }
    return 0
  }

  function randomId() {
    return Math.floor(Math.random() * 100_000_000).toString(16)
  }
</script>
</html>
